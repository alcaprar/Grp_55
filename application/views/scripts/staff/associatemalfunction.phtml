<?php $this->headScript()
    ->appendFile('https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
    ->captureStart() ?>

// codice jQuery inserito da view-script nella sezione head della pagina
$(function(){
    $('#selectProdotti').change(function(event){
        $.ajax({
            type: 'GET',
            url: '<?php echo $this->url(array(
                            'controller' => 'staff',
                            'action' => 'populatemalf'
                        ),
                            'default'
                        )?>',
            data: "prod=" + $('#selectProdotti').val(),
            dataType: 'json',
            success: setMalfunzionamenti
        });
    });

    function setMalfunzionamenti(data){
        $.each(data, function(key, val){
            $("#" + val()).prop('checked', true);
        });
    }
});

<?php $this->headScript()->captureEnd() ?>


<section>
    <h3>Associa Malfunzionamento</h3>
    <p>Utilizza questa pagina per gestire l'associazione tra prodotti e malfunzionamenti.</p>
    <select class="col-sm-3" name="selectProdotti">
            <?php
            foreach($this->Prodotti as $prod)
                {
                    echo '<option value="'.$prod->Nome.'">'.$prod->Nome.'</option>';
                }
            ?>
    </select>
    <div class="col-sm-6" name="checkboxes">
        <?php
        foreach($this->Malfunzionamenti as $malf)
        {
            echo '<input type="checkbox" name="'.$malf->id.'">'.$malf->Malfunzionamento.'</input>';
        }
        ?>
    </div>
</section>